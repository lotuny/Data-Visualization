<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Description</title>
    <script src="https://d3js.org/d3.v5.js"></script>
</head>
<body>
<div>
    <h1>Analysis on London Crimes: What Kinds of Crimes more likely Occur Here?</h1>
    <h2>Student Number: 1924996</h2>
</div>
<div>
    <h3>Introduction</h3>
    <p>
        A crime only occurs out of some reasons. As offenders play an important role in a
        crimeâ€™s occurrence, other environmental factors (e.g. custom, politics and economics) related to the
        scene of a crime must also contribute to it. Therefore, it is reasonable to demonstrate crime data in
        terms of blocks or zones (not necessarily being politically partitioned zones), and the police in
        some boroughs could get a hint for ameliorating the crime situation, by comparison against another
        boroughs with lesser rate of the concerned type of crimes.
    </p>
    <p>
        &nbsp;&nbsp;&nbsp;&nbsp;To conclude, the problem of the project is to reveal how largely the environmental factors of
        London can affect occurrences of crimes. In other words, is there any relation between types of
        crimes and environments of areas where crimes happen? Since crime data in research is based on
        time, the project also intends to show the trend of crime rates with respect to types of crimes across
        several zones of London. If possible, London could be partitioned by grouping together
        geographically adjacent areas with similar patterns of crime types.
    </p>
</div>
<div>
    <h3>Data Set</h3>
    <p>
        The database in use is from DATA.POLICE.UK (https://data.police.uk/data/), containing all open crime data in London
        from Jan. 2017 to Dec. 2019. They are spatio-temporal data. The information intended to be shown are: time (ordinal),
        zone (categorical), total number of crime of a zone (quantitative), type of crime(categorical), number of crime of
        each type of each zone (quantitative). In addition, boundary file was downloaded from Greater London Authority (GLA) at
        (https://data.london.gov.uk/dataset/statistical-gis-boundary-files-london?resource=9ba8c833-6370-4b11-abdc-314aa020d5e0).
    </p>
</div>
<div id="charts">
    <h3>Visualization</h3>
</div>
<div>
    <h3>Results and Summary</h3>
    <p>Placeholder</p>
</div>
<div>
    <h3>Discussion</h3>
    <p>
        Data collection was considered to be a challenge for this project because the information of relation between a case of crime and
        happening borough was not provided, but with geographic coordinates instead.
    </p>
</div>
<div>
    <h3>Conclusion</h3>
    <p>Placeholder</p>
</div>
<div>
    <h3>References</h3>
    <p>
        [1] Cozens, P.M., Saville, G., & Hillier, D. (2005). Crime Prevention Through Environmental
        Design (CPTED): A Review and Modern Bibliography. Journal of Property Management.
        Volume 23, Issue 5, pp328-356.
    </p>
    <p>
        [2] Jeffery, C.R. (1971). Crime Prevention Through Environmental Design. Beverly Hill, CA:
        Sage.
    </p>
    <p>
        [3] Kim, S., Lagrange, R., & Willis, C. (2013). Place and Crime: Integrating Sociology of Place
        and Environmental Criminology. Urban Affairs Review, 49(1), 141-155
    </p>
</div>
<script>
    // data set
    count = 0;
    function bumps(m) {
        const values = [

            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],  // Anti-social behaviour
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],  // Bicycle theft
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],  // Burglary
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],  // Criminal damage and arson
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],  // Drugs
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],  // Other theft
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],  // Possession of weapons
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],  // Public order
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],  // Robbery
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],  // Shoplifting
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],  // Theft from the person
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],  // Vehicle crime
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],  // Violence and sexual offences
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],  // Other crime
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]   // All crime
        ];
        if (count < m)
            return values[count++];
    }

    margin = ({top: 0, right: 0, bottom: 10, left: 0});

    height = 500;
    width = 954;
    m = 33; // number of boroughs
    n = 15; // number of crime categories

    xz = d3.range(m); // the x-values shared by all series
    yz = d3.range(n).map(() => bumps(m)); // the y-values of each of the n series
    y01z = d3.stack()
        .keys(d3.range(n))
        (d3.transpose(yz)) // stacked yz
        .map((data, i) => data.map(([y0, y1]) => [y0, y1, i]));
    yMax = d3.max(yz, y => d3.max(y));
    y1Max = d3.max(y01z, y => d3.max(y, d => d[1]));

    x = d3.scaleBand()
        .domain(xz)
        .rangeRound([margin.left, width - margin.right])
        .padding(0.08);

    xAxis = svg => svg.append("g")
        .attr("transform", `translate(0,${height - margin.bottom})`)
        .call(d3.axisBottom(x).tickSizeOuter(0).tickFormat(() => ""));

    y = d3.scaleLinear()
        .domain([0, y1Max])
        .range([height - margin.bottom, margin.top]);

    z = d3.scaleSequential(d3.interpolateBlues)
        .domain([-0.5 * n, 1.5 * n]);

    layout = 'stacked';

    const svg = d3.select('#charts').append('svg')
        .attr("viewBox", [0, 0, width, height]);

    const rect = svg.selectAll("g")
        .data(y01z)
        .join("g")
        .attr("fill", (d, i) => z(i))
        .selectAll("rect")
        .data(d => d)
        .join("rect")
        .attr("x", (d, i) => x(i))
        .attr("y", height - margin.bottom)
        .attr("width", x.bandwidth())
        .attr("height", 0);

    svg.append("g")
        .call(xAxis);

    function transitionGrouped() {
        y.domain([0, yMax]);

        rect.transition()
            .duration(500)
            .delay((d, i) => i * 20)
            .attr("x", (d, i) => x(i) + x.bandwidth() / n * d[2])
            .attr("width", x.bandwidth() / n)
            .transition()
            .attr("y", d => y(d[1] - d[0]))
            .attr("height", d => y(0) - y(d[1] - d[0]));
    }

    function transitionStacked() {
        y.domain([0, y1Max]);

        rect.transition()
            .duration(500)
            .delay((d, i) => i * 20)
            .attr("y", d => y(d[1]))
            .attr("height", d => y(d[0]) - y(d[1]))
            .transition()
            .attr("x", (d, i) => x(i))
            .attr("width", x.bandwidth());
    }

    function update(layout) {
        if (layout === "stacked") transitionStacked();
        else transitionGrouped();
    }

    update(layout);
</script>
</body>
</html>